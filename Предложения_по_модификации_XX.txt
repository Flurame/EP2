================================================================================
ПРЕДЛОЖЕНИЯ ПО МОДИФИКАЦИИ ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ XX
Система учета заявок на ремонт климатического оборудования
================================================================================

ДАТА СОЗДАНИЯ: 25.12.2025
ВЕРСИЯ: 1.0
РАБОЧЕЕ МЕСТО: XX
РАЗРАБОТЧИК: ИСП-22/23

================================================================================
1. ВВЕДЕНИЕ
================================================================================

Данный документ содержит предложения по модификации и совершенствованию системы 
учета заявок на ремонт климатического оборудования на основе анализа текущих 
требований заказчика, тенденций рынка и технических возможностей.

Все предложения разделены по приоритетности:
- ВЫСОКИЙ: Нужно реализовать в ближайшее время
- СРЕДНИЙ: Желательно реализовать в среднесрочной перспективе
- НИЗКИЙ: Рассмотреть в долгосрочной перспективе

================================================================================
2. МОДИФИКАЦИЯ 1: СИСТЕМА УВЕДОМЛЕНИЙ ПО EMAIL
================================================================================

ПРИОРИТЕТ: ВЫСОКИЙ

2.1 ОПИСАНИЕ:

Добавить автоматическую отправку email уведомлений при происходении важных 
событий в системе:
- Создание новой заявки
- Изменение статуса заявки
- Добавление комментария специалиста
- Назначение специалиста
- Просрочка выполнения
- Приближение срока выполнения
- Смена адреса заявки (если требуется)

2.2 ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ:

Технологии:
- Flask-Mail для интеграции с SMTP
- Celery для асинхронной отправки
- Redis для очереди задач
- Email шаблоны на Jinja2

SMTP сервер:
- Gmail SMTP (smtp.gmail.com:587)
- ИЛИ локальный Postfix/Sendmail

2.3 РЕАЛИЗАЦИЯ:

ШАГ 1: Установка зависимостей
```bash
pip install Flask-Mail celery redis
```

ШАГ 2: Конфигурация (config.py)
```python
MAIL_SERVER = "smtp.gmail.com"
MAIL_PORT = 587
MAIL_USE_TLS = True
MAIL_USERNAME = "repair.system@gmail.com"
MAIL_PASSWORD = "app_specific_password"
MAIL_DEFAULT_SENDER = "repair.system@gmail.com"

CELERY_BROKER_URL = "redis://localhost:6379/0"
CELERY_RESULT_BACKEND = "redis://localhost:6379/0"
```

ШАГ 3: Создание сервиса уведомлений
```python
# services/email_service.py
from flask_mail import Mail, Message
from celery import Celery

mail = Mail()
celery = Celery(__name__)

@celery.task
def send_email_async(recipient, subject, body, html=None):
    msg = Message(subject, recipients=[recipient])
    msg.body = body
    if html:
        msg.html = html
    mail.send(msg)

def notify_new_request(request_id, client_email):
    subject = f"Заявка #{request_id} создана"
    body = f"Ваша заявка на ремонт оборудования принята и обрабатывается."
    send_email_async.delay(client_email, subject, body)

def notify_status_change(request_id, client_email, new_status):
    subject = f"Статус заявки #{request_id} изменен: {new_status}"
    body = f"Статус вашей заявки: {new_status}"
    send_email_async.delay(client_email, subject, body)
```

ШАГ 4: Интеграция в маршруты
```python
@requests_bp.route('/', methods=['POST'])
def create_request(current_user):
    # ... создание заявки ...
    
    # Отправить уведомление клиенту
    client = User.query.get(new_request.client_id)
    from services.email_service import notify_new_request
    notify_new_request(new_request.request_id, client.email)
    
    return jsonify({...}), 201
```

2.4 ШАБЛОНЫ EMAIL:

Создать папку: app/templates/emails/

1. request_created.html - Новая заявка
2. status_changed.html - Статус изменен
3. overdue_warning.html - Просрочка
4. comment_added.html - Комментарий добавлен

Пример шаблона:
```html
<html>
<body>
    <h2>Уважаемый {{ customer_name }}!</h2>
    <p>Ваша заявка №{{ request_id }} была успешно создана.</p>
    <p><strong>Тип оборудования:</strong> {{ equipment_type }}</p>
    <p><strong>Описание проблемы:</strong> {{ problem }}</p>
    <p><strong>Статус:</strong> {{ status }}</p>
    <p>Мы свяжемся с вами в течение 24 часов.</p>
    <p>С уважением,<br>Сервисный центр "IT-Сфера"</p>
</body>
</html>
```

2.5 ОЖИДАЕМЫЕ РЕЗУЛЬТАТЫ:

- Автоматические уведомления пользователям
- Снижение времени реакции на проблемы
- Улучшение прозрачности процесса
- Повышение удовлетворённости клиентов

ВРЕМЯ РЕАЛИЗАЦИИ: 1-2 недели
СЛОЖНОСТЬ: Средняя
СТОИМОСТЬ: ~40,000 руб.

================================================================================
3. МОДИФИКАЦИЯ 2: МОБИЛЬНОЕ ПРИЛОЖЕНИЕ
================================================================================

ПРИОРИТЕТ: ВЫСОКИЙ

3.1 ОПИСАНИЕ:

Разработка нативного мобильного приложения для:
- Специалистов (просмотр заявок, обновление статуса, фото ремонта)
- Клиентов (отслеживание заявок, оценка качества)
- Менеджеров (управление, статистика, утверждение)

3.2 ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ:

Платформы:
- iOS 12+ (iPhone, iPad)
- Android 6.0+ (телефоны, планшеты)

Технологи разработки:
- React Native (кроссплатформенное решение)
- ИЛИ Flutter (альтернатива, быстрее)

Функциональность:
- Аутентификация через JWT токен
- Push уведомления
- Офлайн режим (синхронизация при подключении)
- Камера для фотографирования (специалистам)
- GPS отслеживание места работы (спец-ты)

3.3 АРХИТЕКТУРА:

Frontend (мобильное приложение):
- React Native CLI ИЛИ Expo CLI
- Redux для управления состоянием
- React Navigation для навигации
- Axios для API запросов

Backend (существующее API):
- REST API (без изменений)
- WebSocket для real-time уведомлений (новое)

3.4 КОМПОНЕНТЫ ПРИЛОЖЕНИЯ:

ЭКРАН 1: Вход
- Поле логина
- Поле пароля
- Кнопка входа
- Функция "Запомнить меня"

ЭКРАН 2: Для специалистов - Мои заявки
- Список назначенных заявок
- Фильтр по статусу
- Кнопка для получения новых
- Кнопка для завершения смены

ЭКРАН 3: Детали заявки
- Информация о клиенте
- Описание проблемы
- Текущий статус
- Кнопка для скачивания фото "до"
- Поле для обновления статуса
- Кнопка для загрузки фото "после"
- История комментариев

ЭКРАН 4: Для клиентов - Мои заявки
- Список заявок клиента
- Статус каждой заявки (с цветом)
- Назначенный специалист и его телефон
- Кнопка для оценки качества (QR сканер)

ЭКРАН 5: Профиль
- Информация о пользователе
- Параметры приложения
- История активности
- Кнопка выхода

3.5 ПЛАН РАЗРАБОТКИ:

Фаза 1 (месяц 1): Подготовка и дизайн
- Создание дизайна макетов
- Подготовка API для мобильного
- Создание проекта React Native

Фаза 2 (месяц 2-3): Разработка базовой функциональности
- Экранов авторизации
- Просмотр заявок
- Обновление статуса

Фаза 3 (месяц 4): Продвинутая функциональность
- Работа с камерой
- Push уведомления
- Офлайн синхронизация

Фаза 4 (месяц 5): Тестирование и доработка
- Юнит-тесты
- Интеграционное тестирование
- Оптимизация производительности

Фаза 5 (месяц 6): Выпуск
- Публикация в App Store
- Публикация в Google Play
- Обучение пользователей

3.6 ОЖИДАЕМЫЕ РЕЗУЛЬТАТЫ:

- Возможность работы вне офиса
- Реальное время информирования
- Повышение скорости выполнения
- Снижение времени реакции
- Улучшение контроля качества

ВРЕМЯ РЕАЛИЗАЦИИ: 5-6 месяцев
СЛОЖНОСТЬ: Высокая
СТОИМОСТЬ: ~800,000 - 1,200,000 руб.

================================================================================
4. МОДИФИКАЦИЯ 3: ИНТЕГРАЦИЯ С SMS УВЕДОМЛЕНИЯМИ
================================================================================

ПРИОРИТЕТ: СРЕДНИЙ

4.1 ОПИСАНИЕ:

Отправка SMS уведомлений при происходении критических событий:
- Создание заявки (код подтверждения заявки)
- Завершение работы (уведомление о готовности)
- Приближение срока (напоминание за 1 день)
- Назначение специалиста (время приезда)

4.2 СЕРВИСЫ ДЛЯ ИНТЕГРАЦИИ:

Вариант 1: Twilio
- Простая API
- Надежный сервис
- Стоимость: ~$0.01-0.02 за SMS

Вариант 2: Yandex.SMS (русский сервис)
- Локальное решение
- Быстрая доставка в РФ
- Стоимость: ~1-3 руб. за SMS

Вариант 3: Alligate
- Российский оператор
- Хорошие rates
- Техническая поддержка

4.3 РЕАЛИЗАЦИЯ (Twilio):

```python
# services/sms_service.py
from twilio.rest import Client

TWILIO_ACCOUNT_SID = "your_account_sid"
TWILIO_AUTH_TOKEN = "your_auth_token"
TWILIO_PHONE_NUMBER = "+1234567890"

client = Client(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN)

def send_sms(phone_number, message):
    message = client.messages.create(
        body=message,
        from_=TWILIO_PHONE_NUMBER,
        to=phone_number
    )
    return message.sid

def notify_request_created(client_phone, request_id):
    message = f"Заявка №{request_id} создана. Следите за статусом на сайте."
    send_sms(client_phone, message)

def notify_specialist_assigned(specialist_phone, request_id, arrival_time):
    message = f"Заявка №{request_id}. Приезд в {arrival_time}."
    send_sms(specialist_phone, message)
```

4.4 ОЖИДАЕМЫЕ РЕЗУЛЬТАТЫ:

- Мгновенное уведомление клиентов
- Пониженный процент пропущенных событий
- Быстрая реакция на проблемы
- Возможность подтверждения через SMS

ВРЕМЯ РЕАЛИЗАЦИИ: 1-2 недели
СЛОЖНОСТЬ: Низкая
СТОИМОСТЬ: ~20,000 руб. + стоимость SMS (~0.5-3 млн смс/месяц)

================================================================================
5. МОДИФИКАЦИЯ 4: СИСТЕМА УПРАВЛЕНИЯ РАСПИСАНИЕМ СПЕЦИАЛИСТОВ
================================================================================

ПРИОРИТЕТ: СРЕДНИЙ

5.1 ОПИСАНИЕ:

Добавить функционал планирования работы специалистов:
- Календарь работы каждого специалиста
- Автоматическое назначение в зависимости от загрузки
- Учёт отпусков и больничных
- Оптимизация маршрутов выезда
- Прогноз загруженности

5.2 КОМПОНЕНТЫ:

ТАБЛИЦА: specialist_schedule
```sql
CREATE TABLE specialist_schedule (
    schedule_id SERIAL PRIMARY KEY,
    specialist_id INTEGER REFERENCES users,
    date DATE,
    start_time TIME,
    end_time TIME,
    status VARCHAR(50), -- available, busy, off, vacation, sick
    max_requests INTEGER, -- макс заявок за день
    current_requests INTEGER,
    notes TEXT
);
```

5.3 ФУНКЦИИ:

1. Просмотр календаря:
   - Виды: День, Неделя, Месяц
   - Показать загруженность каждого специалиста
   - Цветовая индикация (свободен, загружен, недоступен)

2. Управление расписанием:
   - Менеджер может устанавливать выходные
   - Специалист может отметить отпуск
   - Система учитывает праздничные дни

3. Автоматическое назначение:
   - При создании заявки система предлагает лучших специалистов
   - Критерии: загруженность, опыт, ближайшее расположение
   - Приоритет назначения: опыт > расположение > загруженность

4. Оптимизация маршрутов:
   - Группировка заявок по районам
   - Предложение оптимального маршрута
   - Экономия на топливе и времени

5.4 UI КОМПОНЕНТЫ:

- Календарь с drag-and-drop для назначения
- График загруженности специалиста
- Карта с маршрутом (интеграция с Google Maps)
- Прогноз на неделю

ВРЕМЯ РЕАЛИЗАЦИИ: 3-4 недели
СЛОЖНОСТЬ: Средняя
СТОИМОСТЬ: ~150,000 руб.

================================================================================
6. МОДИФИКАЦИЯ 5: ИНТЕГРАЦИЯ С СИСТЕМОЙ УЧЕТА ЗАПАСНЫХ ЧАСТЕЙ
================================================================================

ПРИОРИТЕТ: ВЫСОКИЙ

6.1 ОПИСАНИЕ:

Добавить управление запасными частями:
- Каталог запчастей с артикулами
- Учёт наличия на складе
- Автоматический заказ при недостатке
- Калькуляция стоимости ремонта
- Выставление счётов клиентам

6.2 ТАБЛИЦЫ БД:

```sql
CREATE TABLE spare_parts (
    part_id SERIAL PRIMARY KEY,
    article_number VARCHAR(50) UNIQUE,
    name VARCHAR(255),
    category VARCHAR(100),
    supplier_id INTEGER,
    cost_price DECIMAL(10,2),
    selling_price DECIMAL(10,2),
    quantity_in_stock INTEGER,
    min_quantity INTEGER,
    reorder_quantity INTEGER
);

CREATE TABLE repair_parts_used (
    usage_id SERIAL PRIMARY KEY,
    request_id INTEGER REFERENCES repair_requests,
    part_id INTEGER REFERENCES spare_parts,
    quantity INTEGER,
    price DECIMAL(10,2),
    date_used TIMESTAMP
);

CREATE TABLE part_orders (
    order_id SERIAL PRIMARY KEY,
    part_id INTEGER REFERENCES spare_parts,
    quantity INTEGER,
    supplier_id INTEGER,
    order_date DATE,
    delivery_date DATE,
    status VARCHAR(50)
);
```

6.3 ФУНКЦИИ:

1. Управление каталогом:
   - Добавление новых запчастей
   - Редактирование цен
   - Категоризация

2. Управление складом:
   - Просмотр остатков
   - Журнал движения
   - Автоматический заказ при снижении ниже минимума
   - Уведомление о низких остатках

3. Калькуляция затрат:
   - Расчет себестоимости ремонта
   - Маржа прибыли
   - Сумма счёта для клиента

4. Выставление счётов:
   - PDF счёт с деталями
   - Включение работ и запчастей
   - Отправка по email
   - Отслеживание оплаты

6.4 ОТЧЁТЫ:

- Остатки запчастей по категориям
- Наиболее часто используемые запчасти
- Поставщики и их цены
- Рентабельность по типам ремонтов

ВРЕМЯ РЕАЛИЗАЦИИ: 2-3 недели
СЛОЖНОСТЬ: Средняя
СТОИМОСТЬ: ~120,000 руб.

================================================================================
7. МОДИФИКАЦИЯ 6: АНАЛИТИКА И BUSINESS INTELLIGENCE
================================================================================

ПРИОРИТЕТ: СРЕДНИЙ

7.1 ОПИСАНИЕ:

Детальная аналитика и BI дашборд:
- KPI по различным метрикам
- Прогнозирование спроса
- Анализ тренда качества
- Визуализация данных
- Экспорт отчётов

7.2 КОМПОНЕНТЫ:

1. Dashboard (главная панель):
   - KPI: Выполненные заявки, среднее время, средний рейтинг
   - Графики: Тренд за месяц, распределение по типам
   - Таблица: Топ специалистов, проблемные заявки

2. Аналитика по периодам:
   - День, Неделя, Месяц, Квартал, Год
   - Сравнение с предыдущим периодом
   - Тренды и прогнозы

3. Анализ специалистов:
   - Производительность (заявки/день)
   - Качество работы (рейтинг)
   - Специализация (какие типы лучше)
   - Время выполнения

4. Анализ клиентов:
   - Число активных клиентов
   - Частота обращений
   - Средняя стоимость
   - Удовлетворённость

7.3 ВИЗУАЛИЗАЦИЯ:

Используемые графики:
- Линейные (тренды по времени)
- Столбчатые (сравнение)
- Круговые (распределение)
- Тепловые карты (интенсивность)
- Карты (географическое распределение)

Библиотеки:
- Chart.js (простые графики)
- D3.js (сложные визуализации)
- Plotly (интерактивные графики)

7.4 ЭКСПОРТ:

- PDF отчёты (с графиками и таблицами)
- CSV экспорт (для Excel)
- JSON экспорт (для интеграций)
- Автоматическая отправка отчётов по email

ВРЕМЯ РЕАЛИЗАЦИИ: 3-4 недели
СЛОЖНОСТЬ: Средняя
СТОИМОСТЬ: ~180,000 руб.

================================================================================
8. МОДИФИКАЦИЯ 7: СИСТЕМА ОЦЕНКИ ПРОИЗВОДИТЕЛЬНОСТИ И РЕЙТИНГА
================================================================================

ПРИОРИТЕТ: НИЗКИЙ

8.1 ОПИСАНИЕ:

Система KPI для специалистов с автоматическим расчётом:
- Количество выполненных заявок
- Среднее время выполнения
- Процент первичного решения
- Рейтинг по отзывам
- Соблюдение сроков
- Премии и штрафы

8.2 КПИ ПОКАЗАТЕЛИ:

```
KPI = (0.3 * Производительность + 
       0.3 * Качество + 
       0.2 * Соблюдение_сроков + 
       0.2 * Инновации) * 100

Премия = (KPI - 70) * 0.01 * Зарплата

Штрафы:
- Не выполнено в срок: -500 руб.
- Жалоба клиента: -1000 руб.
- Повторное обращение: -500 руб.
```

8.3 ТАБЛИЦЫ:

```sql
CREATE TABLE specialist_kpi (
    kpi_id SERIAL PRIMARY KEY,
    specialist_id INTEGER REFERENCES users,
    period_date DATE,
    completed_count INTEGER,
    avg_time INTEGER,
    first_solution_percent DECIMAL(5,2),
    rating DECIMAL(3,2),
    deadline_compliance DECIMAL(5,2),
    kpi_score DECIMAL(5,2),
    bonus DECIMAL(10,2),
    penalties DECIMAL(10,2)
);
```

8.4 ИНТЕГРАЦИЯ С HR:

- Передача данных в кадровую систему
- Автоматический расчёт премий
- Реестр штрафов
- Истории карьеры

ВРЕМЯ РЕАЛИЗАЦИИ: 2 недели
СЛОЖНОСТЬ: Низкая
СТОИМОСТЬ: ~80,000 руб.

================================================================================
9. МОДИФИКАЦИЯ 8: ИНТЕГРАЦИЯ С CRM СИСТЕМОЙ
================================================================================

ПРИОРИТЕТ: НИЗКИЙ

9.1 ОПИСАНИЕ:

Интеграция с популярными CRM системами:
- Синхронизация клиентов
- Автоматическое создание заявок из CRM
- Обновление контактной информации
- Аналитика в едином окне

9.2 ПОДДЕРЖИВАЕМЫЕ СИСТЕМЫ:

- 1C CRM
- AmoCRM
- Bitrix24
- Salesforce
- HubSpot

9.3 ИНТЕГРАЦИЯ:

Использование API:
```python
# Синхронизация клиентов из CRM
from services.crm_integration import sync_customers

def sync_customers():
    crm_customers = crm_api.get_customers()
    for crm_customer in crm_customers:
        user = User.query.filter_by(phone=crm_customer['phone']).first()
        if not user:
            user = User(
                full_name=crm_customer['name'],
                phone=crm_customer['phone'],
                email=crm_customer['email'],
                user_type='Заказчик'
            )
            db.session.add(user)
    db.session.commit()
```

ВРЕМЯ РЕАЛИЗАЦИИ: 2-3 недели
СЛОЖНОСТЬ: Средняя
СТОИМОСТЬ: ~100,000 - 200,000 руб.

================================================================================
10. МАТРИЦА ПРИОРИТИЗАЦИИ МОДИФИКАЦИЙ
================================================================================

┌─────────────────────────────────────┬────────────┬──────────┬──────────────┐
│ Модификация                         │ Приоритет  │ Время    │ Стоимость    │
├─────────────────────────────────────┼────────────┼──────────┼──────────────┤
│ 1. Email уведомления                │ ВЫСОКИЙ    │ 1-2 нед  │ 40,000       │
│ 2. Мобильное приложение             │ ВЫСОКИЙ    │ 5-6 мес  │ 800-1200K    │
│ 3. SMS уведомления                  │ СРЕДНИЙ    │ 1-2 нед  │ 20,000+SMS   │
│ 4. Планирование специалистов        │ СРЕДНИЙ    │ 3-4 нед  │ 150,000      │
│ 5. Управление запчастями            │ ВЫСОКИЙ    │ 2-3 нед  │ 120,000      │
│ 6. Аналитика и BI                   │ СРЕДНИЙ    │ 3-4 нед  │ 180,000      │
│ 7. Система рейтинга                 │ НИЗКИЙ     │ 2 нед    │ 80,000       │
│ 8. Интеграция с CRM                 │ НИЗКИЙ     │ 2-3 нед  │ 100-200K     │
└─────────────────────────────────────┴────────────┴──────────┴──────────────┘

================================================================================
11. РЕКОМЕНДОВАННЫЙ ПЛАН ВНЕДРЕНИЯ
================================================================================

ФАЗА 1 (3 месяца) - Критически важные:
1. Email уведомления (неделя 1-2)
2. Управление запчастями (неделя 3-5)
3. SMS уведомления (неделя 6-7)
Стоимость: ~180,000 + SMS

ФАЗА 2 (6 месяцев) - Важные:
1. Аналитика и BI (неделя 1-4)
2. Планирование специалистов (неделя 5-8)
3. Система рейтинга (неделя 9-10)
Стоимость: ~410,000

ФАЗА 3 (12 месяцев) - Долгосрочные:
1. Мобильное приложение (месяц 1-6)
2. Интеграция с CRM (месяц 7-8)
Стоимость: ~1,000,000 - 1,400,000

ОБЩАЯ СТОИМОСТЬ: ~1,590,000 - 1,990,000 руб.
ОБЩЕЕ ВРЕМЯ: 12-18 месяцев

================================================================================
12. ЗАКЛЮЧЕНИЕ
================================================================================

Представленные модификации позволят значительно улучшить функциональность и 
эффективность системы. Рекомендуется начать с высокоприоритетных модификаций 
в Фазе 1, которые обеспечат наибольший ROI и улучшат пользовательский опыт.

Все модификации согласуются с архитектурой текущей системы и могут быть 
реализованы с минимальными нарушениями работающего функционала.

================================================================================
КОНЕЦ ДОКУМЕНТА
================================================================================
